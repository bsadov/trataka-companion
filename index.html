<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trakata Companion</title>
</head>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Lato&display=swap');

    * {
        font-family: 'Lato', sans-serif;
    }

    body{
        display: flex;
        justify-content: center;
    }

    ul{
        list-style: circle;
    }

    li b{
        font-size: 0.8em;
    }

    p{
        font-size: 2em;
    }

    .previewImage{
        height: 50px;
    }

    .break{
        flex-basis: 100%;
        height: 20px;
    }

    #mainImage {
        height: 100vh;
    }

    #nav{
        width: 300px;
    }

    #status{
        height: 100px;
    }
</style>

<body>
<div id="nav">
<h1>Trakata Companion</h1>
<p id="status">STAGE: <br><b id="stage">STARE IMAGE</b></p>
<ul>
<li>In <b>SECONDS</b>, set how long <b>EACH</b> meditation interval will last</li>
<li>You'll stare at the image for the allotted time</li>
<li>A bell will chime indicating the start of the closed eye portion</li>
<li>A second bell will chime indicating end of meditation</li>
</ul>
<input type=number id=inputValue value=180 min=10>
<br>
<button id=startButton onclick="startTimer()">Start</button>
<button id=stopButton onclick="stopTimer()">Stop</button>
<button id=resetButton onclick="resetTimer()">Reset</button>
<div class="break"></div>
<img class="previewImage" src="sri-yantra.jpg" onclick="changeImage(this)">
<img class="previewImage" src="sri-yantra-color.svg" onclick="changeImage(this)">
</div>
<img id="mainImage" src="./sri-yantra.jpg">
</body>
</html>

<script>
    let timer;
    let startingValue;
    let stoppedValue;
    let firstStage = true;
    let audio = new Audio('./bell - edgepixel - pixabay.mp3');
    const input = document.getElementById('inputValue');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const resetButton = document.getElementById('resetButton');
    const stageEle = document.getElementById('stage');
    const mainImage = document.getElementById('mainImage');


    disable(stopButton);
    disable(resetButton);

    function startTimer(){
        if(stoppedValue != input.value){
            startingValue = input.value;
            audio.play();
        }
        clearInterval(timer);
        timer = setInterval(myTimer, 1000);
        enable(stopButton);
        enable(resetButton);
        disable(startButton);
    }
    
    function myTimer() {
    input.value--;
    if(input.value == 0){
        if(firstStage){
            audio.play();
            firstStage = false;
            input.value = startingValue;
            stageEle.textContent = "EYES CLOSED";
            mainImage.style.filter = "brightness(0.2)";
            return;
            }
        clearInterval(timer);
        audio.play();
        setTimeout(()=>{audio.currentTime = 0; audio.play();}, 3000);
        stageEle.textContent = "MEDITATION COMPLETE";
        mainImage.style.filter = "";
        disable(stopButton);
        }
    }

    function stopTimer(){
        stoppedValue = input.value;
        clearInterval(timer);
        enable(startButton);
        disable(stopButton);
    }

    function resetTimer(){
        firstStage = true;
        input.value = startingValue;
        clearInterval(timer);
        enable(startButton);
        disable(resetButton);
        disable(stopButton);
        stageEle.textContent = "STARE IMAGE";
        mainImage.style.filter = "";
    }

    function changeImage(img){
        mainImage.src = img.src;
    }

    function disable(element){ element.setAttribute("disabled",""); }
    function enable(element){ element.removeAttribute("disabled"); }
</script>